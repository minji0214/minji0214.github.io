---
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../consts";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog")).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Get all unique tags
const allTags = Array.from(
	new Set(posts.flatMap((post) => post.data.tags || []).filter(Boolean))
).sort();
---

<!doctype html>
<html lang="en">
	<head>
		<link rel="sitemap" href="/sitemap.xml" />
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main>
			<section class="blog-list-content">
				<div class="blog-list-container">
					<div class="blog-header">
						<h1 class="blog-title">BLOG</h1>
						<p class="blog-subtitle">Articles & Stories</p>
						{
							allTags.length > 0 && (
								<div class="blog-filter">
									<button
										class="filter-tag filter-tag--all active"
										data-tag="all"
									>
										전체
									</button>
									{allTags.map((tag) => (
										<button class="filter-tag" data-tag={tag}>
											{tag}
										</button>
									))}
								</div>
							)
						}
					</div>
					<ul class="blog-posts-list">
						{
							posts.map((post) => (
								<li
									class="blog-post-item"
									data-tags={post.data.tags?.join(",") || ""}
								>
									<a href={`/blog/${post.slug}/`} class="blog-post-link">
										<span class="blog-post-date">
											{post.data.pubDate.getFullYear()}년{" "}
											{post.data.pubDate.getMonth() + 1}월{" "}
											{post.data.pubDate.getDate()}일
										</span>
										<h3 class="blog-post-title">{post.data.title}</h3>
										{post.data.tags && post.data.tags.length > 0 && (
											<div class="blog-post-tags">
												{post.data.tags.map((tag) => (
													<span class="blog-post-tag">{tag}</span>
												))}
											</div>
										)}
									</a>
								</li>
							))
						}
					</ul>
				</div>
			</section>
		</main>
		<Footer />
		<script>
			document.addEventListener("DOMContentLoaded", () => {
				const filterButtons = document.querySelectorAll(".filter-tag");
				const postItems = document.querySelectorAll(".blog-post-item");

				filterButtons.forEach((button) => {
					button.addEventListener("click", () => {
						const selectedTag = button.getAttribute("data-tag");

						// Update active state
						filterButtons.forEach((btn) => btn.classList.remove("active"));
						button.classList.add("active");

						// Filter posts
						postItems.forEach((item) => {
							const itemTags = item.getAttribute("data-tags") || "";
							const tags = itemTags.split(",").filter(Boolean);

							if (selectedTag === "all" || tags.includes(selectedTag)) {
								item.style.display = "";
							} else {
								item.style.display = "none";
							}
						});
					});
				});
			});
		</script>
		<style>
			:root {
				--color-bg: #ffffff;
				--color-text: #000000;
				--color-sub: #666666;
				--color-border: #e5e5e5;
			}

			html,
			body {
				margin: 0;
				padding: 0;
				background: var(--color-bg);
				color: var(--color-text);
				font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Inter",
					sans-serif;
			}

			main {
				width: 100%;
				padding: 80px 40px;
			}

			.blog-list-content {
				width: 100%;
			}

			.blog-list-container {
				max-width: 1200px;
				margin: 0 auto;
			}

			.blog-header {
				text-align: center;
				margin-bottom: 60px;
			}

			.blog-title {
				font-size: 2.5rem;
				font-weight: 700;
				color: var(--color-text);
				margin: 0 0 12px 0;
				letter-spacing: -0.5px;
			}

			.blog-subtitle {
				font-size: 1rem;
				color: var(--color-sub);
				margin: 0 0 32px 0;
				font-weight: 400;
			}

			.blog-filter {
				display: flex;
				flex-wrap: wrap;
				gap: 6px;
				justify-content: center;
				align-items: center;
			}

			.filter-tag {
				padding: 4px 12px;
				font-size: 0.8rem;
				font-weight: 400;
				color: var(--color-sub);
				background: transparent;
				border: none;
				cursor: pointer;
				transition: all 0.2s ease;
				letter-spacing: 0.01em;
				position: relative;
			}

			.filter-tag::after {
				content: "";
				position: absolute;
				bottom: 0;
				left: 50%;
				transform: translateX(-50%);
				width: 0;
				height: 1px;
				background: var(--color-text);
				transition: width 0.2s ease;
			}

			.filter-tag:hover {
				color: var(--color-text);
			}

			.filter-tag:hover::after {
				width: 80%;
			}

			.filter-tag.active {
				color: var(--color-text);
				font-weight: 500;
			}

			.filter-tag.active::after {
				width: 80%;
			}

			.blog-posts-list {
				list-style: none;
				padding: 0;
				margin: 0;
			}

			.blog-post-item {
				margin-bottom: 32px;
				padding-bottom: 32px;
				border-bottom: 1px solid var(--color-border);
			}

			.blog-post-item:last-child {
				border-bottom: none;
				margin-bottom: 0;
				padding-bottom: 0;
			}

			.blog-post-link {
				text-decoration: none;
				color: inherit;
				display: block;
				transition: opacity 0.2s ease;
			}

			.blog-post-link:hover {
				opacity: 0.6;
			}

			.blog-post-date {
				display: block;
				font-size: 0.9rem;
				color: var(--color-sub);
				margin-bottom: 8px;
				font-weight: 400;
			}

			.blog-post-title {
				display: block;
				font-size: 1.5rem;
				font-weight: 400;
				color: var(--color-text);
				margin: 0 0 12px 0;
				line-height: 1.4;
				letter-spacing: -0.3px;
			}

			.blog-post-tags {
				display: flex;
				flex-wrap: wrap;
				gap: 8px;
				margin-top: 10px;
			}

			.blog-post-tag {
				display: inline-block;
				font-size: 0.75rem;
				font-weight: 400;
				color: var(--color-sub);
				letter-spacing: 0.01em;
			}

			.blog-post-tag:not(:last-child)::after {
				content: "·";
				margin-left: 8px;
				color: var(--color-border);
			}

			@media (max-width: 900px) {
				main {
					padding: 60px 24px;
				}

				.blog-title {
					font-size: 2rem;
				}

				.blog-post-item {
					margin-bottom: 28px;
					padding-bottom: 28px;
				}

				.blog-post-title {
					font-size: 1.3rem;
				}
			}

			@media (max-width: 600px) {
				main {
					padding: 40px 16px;
				}

				.blog-header {
					margin-bottom: 40px;
				}

				.blog-title {
					font-size: 1.75rem;
				}

				.blog-post-item {
					margin-bottom: 24px;
					padding-bottom: 24px;
				}

				.blog-post-title {
					font-size: 1.2rem;
				}
			}
		</style>
	</body>
</html>
